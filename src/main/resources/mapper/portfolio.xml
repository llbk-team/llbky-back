<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.portfolio.dao.PortfolioDao">
<!-- ////////////////////////////////////////////////////////////////생성 -->
 <insert id="insertPortfolio" parameterType="Portfolio"
   useGeneratedKeys="true" keyProperty="portfolioId">
    INSERT INTO portfolio(
      member_id, title, pdf_file, original_filename, content_type
    ) 
    VALUES(
      #{memberId}, #{title}, #{pdfFile}, #{originalFilename}, #{contentType}
    )
  </insert>

 <!--/////////////////////////////////////////////////////////////////수정 -->
  <!-- AI 피드백 업데이트 -->
  <update id="updatePortfolioFeedback" parameterType="map">
    UPDATE portfolio 
    SET 
      portfolio_feedback = CAST(#{portfolioFeedback} AS JSONB),
      updated_at = NOW()
    WHERE portfolio_id = #{portfolioId}
  </update>

  <update id="updatePortfolioPageCount" parameterType="int">
    UPDATE portfolio
    SET
      page_count = #{pageCount}
    WHERE portfolio_id = #{portfolioId}
  </update>




  <!--/////////////////////////////////////////////////////////삭제-->

  <delete id="deletePortfolio" parameterType="int">
    DELETE FROM portfolio
    WHERE portfolio_id=#{portfolioId}
  </delete>



  <!-- 특정 회원의 포트폴리오 개수 조회 -->
  <select id="countPortfoliosByMemberId" 
          parameterType="int" 
          resultType="int">
    SELECT COUNT(*) 
    FROM portfolio 
    WHERE member_id = #{memberId}
  </select>

 

<!--/////////////////////////////////////////////////////////조회 -->

<!-- 포트폴리오 ID로 조회 -->
  <select id="selectPortfolioById" 
          parameterType="int" 
          resultType="Portfolio">
    SELECT 
      portfolio_id,
      member_id,
      title,
      pdf_file,
      original_filename,
      content_type,
      page_count,
      portfolio_feedback,
      created_at,
      updated_at
    FROM portfolio 
    WHERE portfolio_id = #{portfolioId}
  </select>

  <!-- 회원별 포트폴리오 목록 조회 -->
  <select id="selectPortfoliosByMemberId" 
          parameterType="int" 
          resultType="com.example.demo.portfolio.dto.response.PortfolioListResponse">
    SELECT 
      portfolio_id,
      title,
      updated_at
    FROM portfolio 
    WHERE member_id = #{memberId}
    ORDER BY created_at DESC
  </select>

  <!-- 모든 포트폴리오 조회 -->
  <select id="selectAllPortfolios" resultType="Portfolio">
    SELECT 
      portfolio_id,
      member_id,
      title,
      pdf_file,
      original_filename,
      content_type,
      page_count,
      portfolio_feedback,
      created_at,
      updated_at
    FROM portfolio 
    ORDER BY created_at DESC
  </select>



</mapper>