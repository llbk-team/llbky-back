<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.report.dao.ReportCompareDao">
    <select id="findByPair" resultType="com.example.demo.report.dto.ReportCompare">
        SELECT 
            compare_id AS compareId, 
            report_id1 AS reportId1,
            report_id2 AS reportId2, 
            content::text AS content,
            created_at AS createdAt
        FROM report_compare
        WHERE (report_id1 = #{reportId1} AND report_id2 = #{reportId2})
            OR (report_id1 = #{reportId2} AND report_id2 = #{reportId1})
        LIMIT 1
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="compareId">
        INSERT INTO report_compare(report_id1, report_id2, content, created_at)
        VALUES (#{reportId1}, #{reportId2}, CAST(#{content} AS jsonb), now())
    </insert>
</mapper>